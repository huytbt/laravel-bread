#!/usr/bin/env php
<?php

if ($argc <= 1 || in_array($argv[1], array('--help', '-h', '-?'))) {
    echo <<<EOL
Usage:
  $argv[0] <option>

Options:
\033[32m  -h, --help, -? \033[0m                     Display this help message
\033[32m  test           \033[0m                     Run unit test

EOL;
    return;
}

$composerDir = dirname(dirname($_SERVER['SCRIPT_FILENAME']));
$appDir = dirname($composerDir);
$result = true;
$params = $argv;
unset($params[0], $params[1]);

chdir($appDir);

if ($argv[1] == 'test') {
    passthru("{$appDir}/vendor/bin/phpunit --configuration {$appDir}/phpunit.xml " . implode(' ', $params), $result);
} elseif (!in_array($argv[1], ['init', 'update'])) {
    passthru("php {$appDir}/artisan {$argv[1]} " . implode(' ', $params), $result);
}

exit($result);
